var dnd=dnd||{};!function(){"use strict";dnd.ajax=function(e,n,t){var d=new XMLHttpRequest;d.open("GET",e,!0),d.onload=function(){d.status>=200&&d.status<400?n(d.responseText):t()},d.onerror=function(){t()},d.send()},dnd.selector=function(e,n){if(e=e.trim(),n||(n=document),e.indexOf(" ")===-1){if(0===e.lastIndexOf("."))return n.getElementsByClassName(e.substring(1));if(0===e.lastIndexOf("#"))return n.getElementById(e.substring(1))}return n.querySelectorAll(e)},dnd.appendTo=function(e,n){var t="",d=document.createElement(t);d.innerHTML=n,e.appendChild(d)},dnd.addEventHandler=function(e,n,t){e.addEventListener?e.addEventListener(n,t,!1):e.attachEvent&&e.attachEvent("on"+n,t)}}();var dnd=dnd||{};!function(){"use strict";dnd.vars=dnd.vars||{},dnd.service=dnd.service||{},dnd.templates=function(){n("-js-template-"+dnd.menu,"template-"+dnd.menu+"--header",null,!0),n("-js-template-"+dnd.menu,"template-"+dnd.menu,dnd.service[dnd.menu],!1)};var e=function(e){var n=document.getElementById(e);null!=n&&(n.innerHTML="")},n=function(n,t,d,a){a&&e(n);var r=document.getElementById(t),o=document.getElementById(n);if(null!=r&&null!=o){var i=r.innerHTML,s=d,l=0;if(null!=d)s.forEach(function(e,n){if(l<dnd.filters.amount){var t=i;t=t.replace("#NAME#",e.name),t=t.replace("#DESCRIPTION#",e.description),t=t.replace("#BOOK#",e.rulebook_name),t=t.replace("#URLNAME#","/rulebook/"+e.rulebook_slug+"/feat/"+e.slug),t=t.replace("#URLBOOK#","/rulebook/"+e.rulebook_slug),o.insertAdjacentHTML("beforeend",t),l++}});else{var c=i;o.insertAdjacentHTML("beforeend",c)}}}}();var dnd=dnd||{};!function(){"use strict";dnd.vars=dnd.vars||{},dnd.service=dnd.service||{},dnd.filters=function(){if(dnd.filters.amount=25,dnd.vars.localStorage){localStorage.getItem("filter-amount");null==localStorage.getItem("filter-amount")?localStorage.setItem("filter-amount",dnd.filters.amount):dnd.filters.amount=parseInt(localStorage.getItem("filter-amount"))}for(var e=dnd.selector(".-js-sorting-amount"),n=0;n<e.length;n++){for(var t=e[n],d=t.options,a=0;a<d.length;a++){var r=d[a];r.value==dnd.filters.amount.toString()&&(t.selectedIndex=a)}t.addEventListener("change",function(){var n=this.options[this.selectedIndex].value;dnd.filters.amount=parseInt(n),dnd.vars.localStorage&&localStorage.setItem("filter-amount",dnd.filters.amount),o(e,n),dnd.templates()})}var o=function(e,n){for(var t=0;t<e.length;t++)for(var d=e[t],a=d.options,r=0;r<a.length;r++){var o=a[r];o.value==n.toString()&&(d.selectedIndex=r)}}}}();var dnd=dnd||{};!function(){"use strict";dnd.vars=dnd.vars||{},dnd.service=dnd.service||{};var e="http://dnd.exchange",n=function(){console.log("Error loading data")},t=function(t,d){dnd.ajax(e+"/endpoints",function(r){var o=0,i=0;dnd.service.endpoints=JSON.parse(r),t&&localStorage.setItem("endpoints",r),dnd.service.endpoints.forEach(function(e,n){e.path.indexOf(":id")==-1&&e.path.indexOf(":rid")==-1&&e.path.indexOf(":sid")==-1&&o++}),dnd.service.endpoints.forEach(function(r,s){r.path.indexOf(":id")==-1&&r.path.indexOf(":rid")==-1&&r.path.indexOf(":sid")==-1&&dnd.ajax(e+r.path,function(e){i++,dnd.service[""+r.alias]=JSON.parse(e),t&&localStorage.setItem(r.alias,JSON.stringify(e)),i==o&&a(d)},function(){n()},function(){n()})})},function(){n()},function(){n()})},d=function(e){if(dnd.vars.localStorage&&0==localStorage.length)t(!0,e);else if(dnd.vars.localStorage){var n=0;JSON.parse(localStorage.getItem("endpoints")).forEach(function(t,d){if(n++,t.path.indexOf(":id")==-1&&t.path.indexOf(":rid")==-1&&t.path.indexOf(":sid")==-1){var r=localStorage.getItem(t.alias);dnd.service[""+t.alias]=JSON.parse(JSON.parse(r))}n==JSON.parse(localStorage.getItem("endpoints")).length&&a(e)})}else t(!1,e)},a=function(e){var n=dnd.selector("#Loader");n.classList?n.classList.add("loaded"):n.className+=" loaded",e()};dnd.initService=function(e){var n=dnd.selector("#Loader");dnd.database?(n.style.display="block",d(e)):n.style.display="none"}}();var dnd=dnd||{};!function(){dnd.vars=dnd.vars||{},dnd.service=dnd.service||{},"undefined"!=typeof Storage?dnd.vars.localStorage=!0:dnd.vars.localStorage=!1,dnd.dataLoaded=function(){dnd.filters(),dnd.templates()},dnd.initService(dnd.dataLoaded)}();